<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>2-4電子科カジノへようこそ</title>
</head>
<body>
    <div id="content">
        <p>
            <!-- 初回のみ表示されるべきデフォルトメッセージ -->
            こちらの画面を受付の人に見せてください。
        </p>
    </div>

<script>
    // --- 訪問者を識別するJavaScript ---
    const VISITED_KEY = 'festival_visited_count'; // 訪問回数を示すキー
    const REDIRECT_URL = 'thankyou.html'; 
    
    // Local Storageから訪問回数を取得（なければ0）
    let visitCount = parseInt(localStorage.getItem(VISITED_KEY) || '0', 10);
    // Formの回答状況を取得
    const isFormCompleted = localStorage.getItem('form_completed') === 'true';
    
    // 初回アクセス時 (1回目)
    if (visitCount === 0) {
        // 1回目：訪問履歴を保存 (1を設定)
        localStorage.setItem(VISITED_KEY, '1');
        
        // 初回訪問者向けのコンテンツを表示
        document.getElementById('content').innerHTML = `
            <div style="text-align: center; padding: 20px; background-color: #e6ffe6; border: 3px solid green; border-radius: 8px;">
                <h2 style="color: green; font-size: 1.5em; margin-bottom: 10px;">✅ 初回入場を確認しました！</h2>
                <p style="color: #333;">スタッフにこの画面を見せ、入場処理とチップを受け取ってください。</p>
            </div>
        `;
        
    } 
    // 2回目のアクセス時
    else if (visitCount === 1) {
        // 2回目：訪問履歴を更新 (2を設定)
        localStorage.setItem(VISITED_KEY, '2');
        
        // 2回目用のページにリダイレクト
        window.location.href = `${https://x.gd/ibBC2}?count=2`;

    }
    // 3回目以降のアクセス時 (訪問回数が2以上の状態でアクセス)
    else if (visitCount >= 2) {
        
        // 訪問回数はこれ以上増やさない (常に count >= 3 でチェック)
        // ここでは count=3 として扱い、リダイレクト先のメッセージを固定する
        const finalCount = 3; 

        if (isFormCompleted) {
            // Form回答済みの場合: 3回目以降の特典ページへ進む
            // ページ遷移させたいのであれば、ここでリダイレクトを実行
            window.location.href = `${REDIRECT_URL}?count=${finalCount}`;

        } else {
            // Form未回答の場合: ページ遷移をブロックし、index.html上に終了メッセージを表示

            // コンテンツを上書き
            document.getElementById('content').innerHTML = `
                <div style="text-align: center; padding: 20px; background-color: #fff0f0; border: 3px solid red; border-radius: 8px; max-width: 400px; margin: 40px auto; font-family: sans-serif;">
                    <h2 style="color: red; font-size: 1.5em; margin-bottom: 10px;">⚠️ アンケートにご協力ください</h2>
                    <p style="color: #333;">
                        3回目以降のサービスは、アンケートにご回答いただいた方に限定しております。
                    </p>
                    <p style="color: #333; margin-top: 15px; font-weight: bold;">
                        アンケートを回答後、再度このリンクを踏んでください。
                    </p>
                </div>
            `;
            // 3回目以降のアクセスでも count は 2 のまま維持したい場合は、localStorage.setItem(VISITED_KEY, '2'); を再度実行します。
        }
    }
    
</script>
</body>
</html>
